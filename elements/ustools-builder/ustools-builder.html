<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="ustools-builder-attribute-slider.html">
<link rel="import" href="ustools-builder-bboutput.html">

<dom-module id="ustools-builder">
  <template is="dom-bind">
    <style>
    </style>
      <p>Starting attribute points:<strong>{{startingPoints}}</strong></p>
      <paper-input label="Additional Attribute Points" value="{{additionalAttributePoints}}" type="number" min="0" max="100" auto-validate preventInvalidInput minlength="1" ></paper-input>
      <p>Spend attribute points:<strong>{{spendAttributePoints}}</strong> Remaining attribute points:<strong>{{remainingAttributePoints}}</strong></p>
      <template is="dom-repeat" items="{{attributes}}">
        <ustools-builder-attribute-slider attribute="{{item}}"> </ustools-builder-attribute-slider>
      </template>
      <ustools-builder-bboutput attributes="{{attributes}}"> </ustools-builder-bboutput>
  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'ustools-builder',
        properties: {
          additionalAttributePoints: {
            value: 0,
            type: Number
          },
          spendAttributePoints: {
            type: Number,
            //computed: 'calculateSpendAttributePoints(attributes)'
            value: 0
          },
          remainingAttributePoints: {
            type: Number,
            value: 10
          },
          attributes: {
            type: Array,
            value: [
              {
                name: 'Strength',
                value: 1,
                decription: 'Your Physical Strength'
              },
              {
                name: 'Speed',
                value: 1,
                decription: 'Your Physical Strength'
              }, {
                name: 'Orgasm Resistance',
                value: 1,
                decription: 'Your Physical Strength'
              }, {
                name: 'Submission Resistance',
                value: 1,
                decription: 'Your Physical Strength'
              }, {
                name: 'Submission',
                value: 1,
                decription: 'Your Physical Strength'
              }, {
                name: 'Force orgasm',
                value: 1,
                decription: 'Your Physical Strength'
              }
            ]
          },
        },
        observers: [
          'updatedAttributes(attributes.*)',
          'updatedAddAttr(additionalAttributePoints)'
        ],
        ready: function() {
          this.startingPoints = 10;
          this.calculateRemainingAttributePoints();
        },
        updatedAttributes: function() {
          this.spendAttributePoints = this.calculateSpendAttributePoints(this.attributes);
          this.remainingAttributePoints = this.calculateRemainingAttributePoints();
        },
        calculateSpendAttributePoints: function(attributes) {
          var spend = 0;
          attributes.forEach(function(attribute) {
            spend = spend + parseInt(attribute.value) - 1;
          });
          return spend;
        },
        calculateRemainingAttributePoints: function() {
          var ra = 10;
          ra = ra + parseInt(this.additionalAttributePoints);
          ra = ra - parseInt(this.spendAttributePoints);
          return ra;
        },
        updatedAddAttr: function() {
          this.remainingAttributePoints = this.calculateRemainingAttributePoints();
        }
      });
    })();
  </script>
</dom-module>
